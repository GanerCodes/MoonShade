#version 330 core
out ğŸœ FragColor;
in ğŸ› pos;

uniform         ğŸš res;
uniform         ğŸ™ t;

#define Ï„ 6.28318530718
#define Ï€ 3.14159265359
#define ó·º 1.57079632679

ğŸ› rgb2hsv(ğŸ› c) {
    ğŸœ K = ğŸœ(0, -â…“, â…”, ó·°¾);
    ğŸœ p = mix(ğŸœ(cáµ‡áµ, KÊ·á¶»), ğŸœ(cáµáµ‡, KË£Ê¸), step(cáµ‡, cáµ));
    ğŸœ q = mix(ğŸœ(pË£Ê¸Ê·, cÊ³), ğŸœ(cÊ³, pÊ¸á¶»Ë£), step(pË£, cÊ³));
    ğŸ™ d = qË£ - â¤ˆ(qÊ·, qÊ¸);
    ğŸ™ e = 1.0e-10;
    â†ª ğŸ›(â«°(qá¶»+(qÊ·-qÊ¸) Ã· (6â‹…d+e)), dÃ·(qË£+e), qË£);
}
ğŸ› hsv2rgb(ğŸ› c) {
    ğŸœ K = ğŸœ(1, â…”, â…“, 3);
    ğŸ› p = â«°(6â‹…fract(cË£Ë£Ë£ + KË£Ê¸á¶») - KÊ·Ê·Ê·);
    â†ª cá¶» â‹… mix(KË£Ë£Ë£, p - KË£Ë£Ë£, cÊ¸);
}

ğŸ™ sq(ğŸ™ x){â†ª xâ‹…x;}
ğŸ™ min2(ğŸš v){â†ª â¤ˆ(vË£,vÊ¸);}
ğŸ™ max2(ğŸš v){â†ª â¤‰(vË£,vÊ¸);}
ğŸ™ min3(ğŸ› v){â†ª â¤ˆ(â¤ˆ(vË£,vÊ¸),vá¶»);}
ğŸ™ max3(ğŸ› v){â†ª â¤‰(â¤‰(vË£,vÊ¸),vá¶»);}

ğŸ™ pws(ğŸ™ x,ğŸ™ y) { â†ª â´µ(x)â‹…pow(â«°(x),y); }

ğŸ› star(ğŸš p, ğŸ™ t, ğŸ™ antiblur) {
    p â‹…= 10;
    p = ğŸš(5.0â‹…atan(pÊ¸, pË£),
           ((length(p)-10)Ã·5 + 1)â‹…2.5);
    // ğŸ™ v = pÊ¸ - 0.9â‹…pws(ô‹¼(0.9â‹…ô‹²(pË£)), 0.85);
    ğŸ™ v = pÊ¸ - ô‹¼(1.1â‹…(â«°(ô‹³(pË£Ã·2))-â«°(ô‹²(pË£Ã·2))));
    â†ª hsv2rgb(ğŸ›(â¸“(2.2â‹…t, 1), 0.6, ó·¹„(-vâ‹…antiblur, 0, 1)));
}

ğŸœ starz(ğŸš p, ğŸ™ t, ğŸš off, ğŸ™ antiblur) {
    p += ô‹²(ğŸš(401.29, -4.3)â‹…off);
    ğŸš loc = â¬“(pÃ·2 + Â½) + off;
    pË£ += -2â‹…â«°(ô‹³(locÊ¸))â‹…t;
    loc = â¬“(pÃ·2 + Â½) + off;
    p = â¸“(p+2, 4)-2;
    ğŸœ c = ğŸœ(0);
    ğŸ™ sd = â¸“(2â‹…ô‹³(24.0â‹…locË£)+5.5â‹…ô‹²(31.0â‹…locÊ¸), 1);
    p â‹…= 4.0 + ô‹²(49.0â‹…sd);
    p += ğŸš(ô‹³(sdâ‹…52.5), ô‹²(sd+200));
    Â¿(sd â‰¤ Â½) {
        ğŸ™ d = length(p),
           a = atan(pÊ¸,pË£)+1.0Ã·sdâ‹…2.0â‹…sdâ‹…tâ‹…ô‹²(Ï„â‹…sd);
        p = dâ‹…ğŸš(ô‹³(a),ô‹²(a));
        ğŸ™ tt = tÃ·(5.0+2.0â‹…sd) + 2â‹…sd;
        ğŸ› c1 = star(pÃ·(1 + 0.005â‹…antiblur), tt, sd+antiblur);
        ğŸ› c2 = star((1.1 + â…’â‹…sd)â‹…p, tt, sd+antiblur);
        c = ó·¹„(ğŸœ(c1 - c2, length(c1)â‰¥0.99 â­œ(length(c2)â‰¥0.99 â­œâ…˜â­ 1)â­ 0), 0, 1);
    }Â¡{
        ğŸ™ tt = ó·¹„(1-10â‹…length(p), 0, 1);
        ğŸ› cc = hsv2rgb(ğŸ›(â¤‰(sd, â…•)â‹…t + sd, 0.03â‹…sd + â…’, tt));
        c = ğŸœ(cc, â…’â‹…length(tt));
    }
    â†ª c;
}

ğŸ™ box(ğŸš p, ğŸš b) {
    ğŸš d = â«°(p)-b;
    â†ª length(â¤‰(d,0.0)) + â¤ˆ(â¤‰(d.x,d.y),0.0); }
ğŸ™ xor(ğŸ™ x, ğŸ™ y) { â†ª â¤‰(â¤ˆ(x,y),-â¤‰(x,y)); }

void main() {
    ğŸš p = gl_FragCoord.xy Ã· res;
    // ğŸš p = gl_FragCoord.xy Ã· min2(res);
    
    ğŸœ c = ğŸœ(0);
    p = (p-Â½)â‹…5;
    cÊ³=1.0-â«°(xor(box   (p,ğŸš(1)),
                 length(p-ğŸš(Â¾,Â¾))-1.0));
   
    cÊ·=1;
    FragColor = ğŸœ(cË£Ê¸á¶»â‹…cÊ·, 1.0);
    
    // p -= ğŸš(Â½);
    // p â‹…= 8.0;
    // p += ğŸš(-t,5);
    // 
    // ğŸœ c = ğŸœ(0);
    // 
    // ğŸ™ c1 = 265.0Ã·360.0; // rgb2hsv(ğŸ›(0.0,0.0,1.0));
    // ğŸ™ c2 = 290.0Ã·360.0; // rgb2hsv(ğŸ›(0.6,â…•,1.0));
    // ğŸ™ D = mix(c1, c2, ó·¹„(
    //             ô‹²(pÊ¸)â‹…ô‹³(pË£)+ô‹²(pÊ¸-Â½â‹…ô‹³(â…•â‹…t))-â…•â‹…ô‹³(t)
    //             +2â‹…ô‹³(pË£+ô‹²(pÊ¸)-ô‹³(t-pË£)â‹…pÊ¸)â‹…ô‹²(pÊ¸â‹…â…•+ô‹³(0.05â‹…pÊ¸+â¸“(pË£,Ï„)))
    //             +ô‹³(pÊ¸-â¸“(pË£,Ï„)), 0, 1));
    // ğŸ› d = hsv2rgb(ğŸ›(D, 1.0, 0.9)) â‹… 1.0;
    // c += ğŸœ(dâ‹…0.025, 0.025);
    // 
    // âˆ€(ğ‘– i = 0; i < 200; i+=ó·¹„(iÃ·5,1,4)) {
    //     ğ‘– o = i/3;
    //     ğŸ™ s = 0.001 + oÃ·22.5;
    //     c += (1-c)â‹…(1-cÊ·)â‹…starz(sâ‹…p, t, ğŸš(3123â‹…i, 25â‹…i + 1221 - 35â‹…o), 2+o); }
    // // c = ğŸœ(d, 1.0);
    // c += (1-c)â‹…ğŸœ(â…’â‹…d,Â½);
    // FragColor = ğŸœ(cË£Ê¸á¶»â‹…cÊ·, 1.0);
}