uniform ğŸš res;
uniform ğŸ™ t;
uniform ğŸ› vp_loc;
uniform ğŸš vp_ang;

#define MAX_ITERS 128
#define Î´ 0.001
#define Îµ 0.0001
#define ê¬· length
#define ê¬¼ normalize

ğŸ› Î¸XY(ğŸ› p,ğŸ™ r) â‡’â†ª ğŸ›(pË£â‹…ô‹³(r)-pÊ¸â‹…ô‹²(r),pË£â‹…ô‹²(r)+pÊ¸â‹…ô‹³(r),pá¶»);
ğŸ› Î¸XZ(ğŸ› p,ğŸ™ r) â‡’â†ª ğŸ›(pË£â‹…ô‹³(r)-pá¶»â‹…ô‹²(r),pÊ¸,pË£â‹…ô‹²(r)+pá¶»â‹…ô‹³(r));
ğŸ› Î¸YZ(ğŸ› p,ğŸ™ r) â‡’â†ª ğŸ›(pË£,pÊ¸â‹…ô‹³(r)-pá¶»â‹…ô‹²(r),pÊ¸â‹…ô‹²(r)+pá¶»â‹…ô‹³(r));
ğŸ› Î¸XZYZ  (ğŸ› p, ğŸš Î¸) â‡’â†ª Î¸XZ(Î¸YZ(p, Î¸Ë£), Î¸Ê¸);
ğŸ› Î¸XZYZ_i(ğŸ› p, ğŸš Î¸) â‡’â†ª Î¸YZ(Î¸XZ(p,Â¯Î¸Ë£),Â¯Î¸Ê¸);

ğŸ™ xor(ğŸ™ x, ğŸ™ y) â‡’â†ª â¤‰(â¤ˆ(x,y),Â¯â¤‰(x,y));

ğŸ™ box(ğŸ› p, ğŸ› b) â‡’
    ğŸ› d = â«°(p)-b;
    â†ª ê¬·(â¤‰(d,0)) + â¤ˆ(max3(d),0);
ğŸœ elong_(ğŸ› p, ğŸ› h) â‡’
    ğŸ› q = â«°(p)-h;
    â†ª ğŸœ(sign(p)â‹…â¤‰(q,0),â¤ˆ(â¤‰(qË£,â¤‰(qÊ¸,qá¶»)),0));
ğŸ› elong(ğŸ› p, ğŸ› h) â‡’â†ª p-ó·¹„(p,-h,h);
ğŸ™ sphere(ğŸ› p) â‡’â†ª ê¬·(p)-1;
ğŸ™ cube  (ğŸ› p) â‡’â†ª box(p,ğŸ›(1));
#define revolve(Æ’,p,d) ((Æ’)(ğŸš(ê¬·((p)Ë£á¶»)-d, (p)Ê¸)))
#define extrude(Æ’,p,h) (_extrude((p),(Æ’)((p)Ë£Ê¸),h))
ğŸ™ _extrude(ğŸ› p, ğŸ™ d, ğŸ™ h) â‡’
    ğŸš w = ğŸš(d, â«°(pá¶»)-h);
    â†ª â¤ˆ(max2(w),0) + ê¬·(â¤‰(w,0));

ğŸ™ circle(ğŸš p) â‡’â†ª ê¬·(p)-1;
ğŸ™ box2(ğŸš p, ğŸš b) â‡’
    ğŸš d = â«°(p)-b;
    â†ª ê¬·(â¤‰(d,0)) + â¤ˆ(max2(dË£Ê¸),0);

î¬¦ #define bruh(p) box2((p),ğŸš(1,2))
î¬¦ ğŸ™ r = revolve(bruh, p, o);

ğŸ™ weird_shape(ğŸš p) â‡’â†ª xor(circle(p)+â…“, box2(p+ğŸš(1,â…”),ğŸš(1,â…”)));
ğŸ™ weird_shape_2(ğŸ› p) â‡’â†ª extrude(weird_shape,p,â…“);
ğŸ™ ğ¼¥(ğŸ› p) â‡’
    î¬¦ â†ª xor(ê¬·(p)-1,box(p+ğŸ›(0,Â½,Â½),ğŸ›(1)));
    î¬¦ â†ª â¤ˆ(ê¬·(p)-1,box(p+ğŸ›(0,Â½,Â½),ğŸ›(1)));
    î¬¦ â†ª â¤ˆ(box(p,ğŸ›(1)),pÊ¸+1);
    î¬¦ â†ª pÊ¸+1;
    î¬¦ p = ğŸ›(ê¬·(pË£á¶»)-1, pÊ¸, 0);
    î¬¦ â†ª box(p-ğŸ›(1+ô‹³(t),0,0),ğŸ›(1));
    î¬¦ ğŸ™ o = 2+ô‹³(t);
    î¬¦ ğŸ™ r = revolve(circle, p, o);
    î¬¦ ğŸ™ c = extrude(circle, p-ğŸ›(o,3,0), 0.2);
    î¬¦ â†ª â¤ˆ(c,r);
    î¬¦ â†ª f(p);
    î¬¦ p = Î¸YZ(Î¸XZ(p, -Â½â‹…ó·º), -Â½â‹…ó·º);
    
    â†ª sphere(elong(p, ğŸ›(5,0,0)));
    â†ª revolve(weird_shape, p, 2+ô‹³(t));
    â†ª extrude(weird_shape, p, 0.2);
    
    î¬¦ ğŸš Î± = ğŸš(Â½â‹…ó·º,â…“);
    î¬¦ â†ª weird_shape_2(
    î¬¦     Î¸XZYZ_i(
    î¬¦         elong(
    î¬¦             Î¸XZYZ(p,Î±),
    î¬¦             ğŸ›(â«°(ô‹³(tâ‹…â…•)),0,0)),
    î¬¦         Î±));
    

ğŸ› ê¬¶(ğŸ› p) â‡’â†ª ê¬¼(ğŸ›(ğ¼¥(p+ğŸ›(Îµ,0,0)),
                ğ¼¥(p+ğŸ›(0,Îµ,0)),
                ğ¼¥(p+ğŸ›(0,0,Îµ)))-ğ¼¥(p));

ğŸœ ğ¼(ğŸ› p) â‡’
    î¬¦ ğŸ™ o = 2+ô‹³(t);
    î¬¦ ğŸ™ c = extrude(circle, p-ğŸ›(o,0,0), 0.2);
    î¬¦ Â¿(câ‰¤5â‹…Î´) â†ª ğŸœ(0,1,0,1);
    î¬¦ Â¿(pÊ¸â‰¤ó·°¾+Î´) â†ª ğŸœ(Â½,Â½,Â½,1);
    â†ª ğŸœ(1,Â½â‹…(1+ô‹³(pÊ¸+pá¶»)),Â½â‹…(1+ô‹²(pË£)),1);
    î¬¦ â†ª ğŸœ(Â½+Â½â‹…sin(2â‹…pË£),Â½+Â½â‹…cos(2â‹…pÊ¸),Â½+Â½â‹…cos(2â‹…pá¶»),1);

struct â„œâ„œ { ğŸœ ğšŒ; ğŸ› p; ğŸ™ d; ğ‘– i; };

ğŸ™ exposure(ğŸ› C_s, ğŸ› dir) â‡’
    ğŸ› p = C_s;
    ğŸ™ d = 99999999;
    ğŸ™ s = d;
    ğ‘– i=0;
    âˆ€(;i<MAX_ITERS;i++) â‡’
        d = ğ¼¥(p);
        s = â¤ˆ(s,d);
        Â¿(dâ‰¥1000.0) â‡¥;
        Â¿(dâ‰¤ó·°¾) â†ª 0.;
        p += â¤‰(â«°(d),ó··‰)â‹…dir;
    â†ª ó·¹„((1.â‹…MAX_ITERS/i)â‹…(100â‹…s),ó··†,1.25);

â„œâ„œ render(ğŸ› C_s, ğŸ› dir) â‡’
    ğŸ› p = C_s;
    ğŸœ ğšŒ = ğŸœ(0);
    ğŸ™ d = 99999999;
    ğ‘– i=0;
    á–² close=âœ—;
    âˆ€(;i<MAX_ITERS;i++) â‡’
        d = ğ¼¥(p);
        Â¿(dâ‰¥1000.0) â‡¥;
        Â¿(dâ‰¤40â‹…Î´)
            close = âœ“;
            Â¿(dâ‰¤Î´) â‡’
                ğŸœ c = ğ¼(p);
                ğŸ› g = ê¬¶(p);
                cÊ³áµáµ‡ = (1-Â½â‹…pow(1.â‹…iÃ·MAX_ITERS,5))â‹…cÊ³áµáµ‡;
                ğšŒ = mix(c,ğŸœ(ğšŒÊ³áµáµ‡,1),ğšŒáµƒ);
                close=âœ—;
                Â¿(ğšŒáµƒ â‰¥ 0.99) â‡¥;
        p += dâ‹…dir;
    ğšŒ Ã·= â¤‰(ó··‰â‹…pow(ê¬·(p-C_s),2),1);
    î¬¦ Â¿(close) ğšŒ=ğŸœ(1,0,0,1);
    â†ª â„œâ„œ(ğšŒ,p,d,i);

ğŸ™ a(ğŸš v) â‡’â†ª â¤ˆ(ê¬·(v-ğŸš(0,1))-1,max2(â«°(v-ğŸš(ó·°¾,1)))-1)â‹…(ê¬·(v-ğŸš(0,1))-.3);

á—œ main() â‡’
    ğŸš p = (gl_FragCoordË£Ê¸ - Â½â‹…res)Ã·min2(res);
    
    ğŸŸ‘
    ğŸ™ FOV = 90;
    ğŸ™ cam_dist = 100;
    ğŸ™ hFOV = FOVâ‹…ô‹´(Ï€â‹…FOVÃ·360);
    ğŸ› p_e = ğŸ›(hFOVâ‹…p, Â¯cam_dist);
    ğŸ› C_s = vp_loc;
    ğŸ› C_e = C_s + Î¸XZYZ(p_e, vp_angÊ¸Ë£â‹…ğŸš(ó·°¾,1));
    ğŸ› dir = ê¬¼(C_e-C_s);
    â„œâ„œ h = render(C_s, dir);
    ğŸ› j = háµ–-18â‹…Î´â‹…dir;
    ğŸ› g = ê¬¶(j);
    î¬¦ hô€²Ÿ Ê³áµáµ‡ â‹…= exposure(j,ê¬¼(ğŸ›(-2,.5,-1)));
    hô€²Ÿ Ê³áµáµ‡ = Â¾â‹…hô€²Ÿ Ê³áµáµ‡ + Â½â‹…â«°(g);
    FragColor = ğŸœ(hô€²Ÿ Ê³áµáµ‡â‹…hô€²Ÿ áµƒ, 1);
    ğŸŸ‘
    
    ğŸŸ‘
    p â‹…= 5;
    ğŸ™ h = â¤‰(â¤ˆ(a(p),a(-p))â‹…pÊ¸, length(p)-2);
    FragColor = ğŸœ(ğŸ›(max2(â«°(p))>2.01â­œ0â­h<0â­œ0â­1),1.0);
    ğŸŸ‘
    
    î¬¦ ğŸŸ‘
    ğŸœ c = ğŸœ(0);
    p = pâ‹…5;
    î¬¦ ğŸ™ v = â¤ˆ(box2(p,ğŸš(1)), ê¬·(p-ğŸš(Â¾,Â¾))-1);
    î¬¦ p = elong(ğŸ›(p+ğŸš(â…’,0),0.0), ğŸ›(â«°(ô‹³(t)),0,0))Ë£Ê¸;
    î¬¦ ğŸœ ğ’‘ = elong_(ğŸ›(p+ğŸš(â…’,0),0.0), ğŸ›(â«°(ô‹³(t)),0,0));
    î¬¦ ğŸ™ A = box2(ğ’‘Ë£Ê¸,ğŸš(1));
    î¬¦ ğŸ™ B = ê¬·(ğ’‘Ë£Ê¸ -ğŸš(Â¾,Â¾) )-1;
    î¬¦ ğŸ™ v = xor(A,B)+ğ’‘Ê·;
    î¬¦ ğŸ™ v = B+ğ’‘Ê·;
    î¬¦ ğŸ™ v = xor(B,B+Â½)+ğ’‘Ê·;
    î¬¦ ğŸ™ v = box2(p,ğŸš(1));
    î¬¦ ğŸ™ v = â¤‰(â«°(pË£)-1,â«°(pÊ¸)-1);
    î¬¦ ğŸ™ v = ê¬·(p)-1;
    ğŸ™ v = â¤‰(â«°(pË£)-1,-(â«°(pÊ¸)-1));
    ğŸ™ H = â…’;
    ğŸ™ j = â¸“(v,H);
    cáµ‡=.8â‹…(jâ‰¤Â½â‹…H â­œsmoo(â«°(2â‹…(2â‹…j/H-Â½)),8)â­ 1);
    cÊ³=vâ‰¤0 â­œcáµ‡â­ 0;
    Â¿(â«°(v)â‰¤Â¾â‹…â…’â‹…H) cáµ=1;
    cÊ·=1;
    Â¿(max2(â«°(pË£Ê¸))â‰¥2) c=ğŸœ(0);
    FragColor = ğŸœ(cË£Ê¸á¶»â‹…cÊ·, 1);
    î¬¦ ğŸŸ‘