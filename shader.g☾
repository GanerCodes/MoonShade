uniform ğŸš res;
uniform ğŸ™ t;
uniform ğŸ› vp_loc;
uniform ğŸš vp_ang;

#define MAX_ITERS 128
#define Î´ 0.001
#define Îµ 0.0001
#define ê¬· length

ğŸ› Î¸XY(ğŸ› p,ğŸ™ r) â‡’â†ª ğŸ›(pË£â‹…ô‹³(r)-pÊ¸â‹…ô‹²(r),pË£â‹…ô‹²(r)+pÊ¸â‹…ô‹³(r),pá¶»);
ğŸ› Î¸XZ(ğŸ› p,ğŸ™ r) â‡’â†ª ğŸ›(pË£â‹…ô‹³(r)-pá¶»â‹…ô‹²(r),pÊ¸,pË£â‹…ô‹²(r)+pá¶»â‹…ô‹³(r));
ğŸ› Î¸YZ(ğŸ› p,ğŸ™ r) â‡’â†ª ğŸ›(pË£,pÊ¸â‹…ô‹³(r)-pá¶»â‹…ô‹²(r),pÊ¸â‹…ô‹²(r)+pá¶»â‹…ô‹³(r));
ğŸ› Î¸XZYZ  (ğŸ› p, ğŸš Î¸) â‡’â†ª Î¸XZ(Î¸YZ(p, Î¸Ë£), Î¸Ê¸);
ğŸ› Î¸XZYZ_i(ğŸ› p, ğŸš Î¸) â‡’â†ª Î¸YZ(Î¸XZ(p,Â¯Î¸Ë£),Â¯Î¸Ê¸);

ğŸ™ xor(ğŸ™ x, ğŸ™ y) â‡’â†ª â¤‰(â¤ˆ(x,y),Â¯â¤‰(x,y));

ğŸ™ box(ğŸ› p, ğŸ› b) â‡’
    ğŸ› d = â«°(p)-b;
    â†ª ê¬·(â¤‰(d,0)) + â¤ˆ(max3(d),0);
ğŸœ elong_(ğŸ› p, ğŸ› h) â‡’
    ğŸ› q = â«°(p)-h;
    â†ª ğŸœ(sign(p)â‹…â¤‰(q,0),â¤ˆ(â¤‰(qË£,â¤‰(qÊ¸,qá¶»)),0));
ğŸ› elong(ğŸ› p, ğŸ› h) â‡’â†ª p-ó·¹„(p,-h,h);
ğŸ™ sphere(ğŸ› p) â‡’â†ª ê¬·(p)-1;
ğŸ™ cube  (ğŸ› p) â‡’â†ª box(p,ğŸ›(1));
#define revolve(Æ’,p,d) ((Æ’)(ğŸš(ê¬·((p)Ë£á¶»)-d, (p)Ê¸)))
#define extrude(Æ’,p,h) (_extrude((p),(Æ’)((p)Ë£Ê¸),h))
ğŸ™ _extrude(ğŸ› p, ğŸ™ d, ğŸ™ h) â‡’
    ğŸš w = ğŸš(d, â«°(pá¶»)-h);
    â†ª â¤ˆ(max2(w),0) + ê¬·(â¤‰(w,0));

ğŸ™ circle(ğŸš p) â‡’â†ª ê¬·(p)-1;
ğŸ™ box2(ğŸš p, ğŸš b) â‡’
    ğŸš d = â«°(p)-b;
    â†ª ê¬·(â¤‰(d,0)) + â¤ˆ(max2(dË£Ê¸),0);

î¬¦ #define bruh(p) box2((p),ğŸš(1,2))
î¬¦ ğŸ™ r = revolve(bruh, p, o);

ğŸ™ weird_shape(ğŸš p) â‡’â†ª xor(circle(p)+â…“, box2(p+ğŸš(1,â…”),ğŸš(1,â…”)));
ğŸ™ weird_shape_2(ğŸ› p) â‡’â†ª extrude(weird_shape,p,â…“);
ğŸ™ ğ¼¥(ğŸ› p) â‡’
    î¬¦ p = ğŸ›(ê¬·(pË£á¶»)-1, pÊ¸, 0);
    î¬¦ â†ª box(p-ğŸ›(1+ô‹³(t),0,0),ğŸ›(1));
    î¬¦ ğŸ™ o = 2+ô‹³(t);
    î¬¦ ğŸ™ r = revolve(circle, p, o);
    î¬¦ ğŸ™ c = extrude(circle, p-ğŸ›(o,3,0), 0.2);
    î¬¦ â†ª â¤ˆ(c,r);
    î¬¦ â†ª f(p);
    î¬¦ p = Î¸YZ(Î¸XZ(p, -Â½â‹…ó·º), -Â½â‹…ó·º);
    
    ğŸš Î± = ğŸš(Â½â‹…ó·º,â…“);
    â†ª weird_shape_2(
        Î¸XZYZ_i(
            elong(
                Î¸XZYZ(p,Î±),
                ğŸ›(â«°(ô‹³(tâ‹…â…•)),0,0)),
            Î±));
    
    î¬¦ â†ª sphere(elong(p, ğŸ›(0,4,0)));

ğŸ› ê¬¶(ğŸ› p) â‡’â†ª normalize(ğŸ›(ğ¼¥(p+ğŸ›(Îµ,0,0)),
                        ğ¼¥(p+ğŸ›(0,Îµ,0)),
                        ğ¼¥(p+ğŸ›(0,0,Îµ)))-ğ¼¥(p));
ğŸœ ğ¼(ğŸ› p) â‡’
    î¬¦ ğŸ™ o = 2+ô‹³(t);
    î¬¦ ğŸ™ c = extrude(circle, p-ğŸ›(o,0,0), 0.2);
    î¬¦ Â¿(câ‰¤5â‹…Î´) â†ª ğŸœ(0,1,0,1);
    â†ª ğŸœ(1,1,1,1);

ğŸœ render(ğŸš ğš™) â‡’
    ğŸ™ FOV = 125;
    ğŸ™ cam_dist = 100;
    ğŸ™ hFOV = FOVâ‹…ô‹´(Ï€â‹…FOVÃ·360);
    ğŸ› p_e = ğŸ›(hFOVâ‹…ğš™, Â¯cam_dist);

    ğŸ› C_s = vp_loc;
    ğŸ› C_e = C_s + Î¸XZYZ(p_e, vp_angÊ¸Ë£â‹…ğŸš(ó·°¾,1));
    ğŸ› dir = normalize(C_e - C_s);

    ğŸ› p = C_s;
    á–² close = âœ—;

    ğŸœ ğšŒ = ğŸœ(0);
    ğŸ™ d = 99999999;
    ğ‘– i=0;
    âˆ€(;i<MAX_ITERS;i++) â‡’
        d = ğ¼¥(p);
        Â¿(dâ‰¤10â‹…Î´)
            close=âœ“;
            Â¿(dâ‰¤Î´) â‡’
                î¬¦ ğŸ› A = ê¬¶(p+5â‹…ğŸ›(Î´,0,0));
                î¬¦ ğŸ› B = ê¬¶(p+5â‹…ğŸ›(0,Î´,0));
                î¬¦ ğŸ› C = ê¬¶(p+5â‹…ğŸ›(0,0,Î´));
                î¬¦ ğŸ› G = ê¬¶(p);
                î¬¦ Â¿(ê¬·(ğŸ›(ê¬·(A-G),ê¬·(B-G),ê¬·(C-G)))>ó··‰) â†ª ğŸœ(1,0,0,1);
                
                ğŸœ c = ğ¼(p);
                cÊ³áµáµ‡ = (1-i/MAX_ITERS)â‹…cÊ³áµáµ‡â‹…Â½â‹…â¤‰(0, dot(ê¬¶(p), -normalize(dir)));
                ğšŒ = ğŸœ(ğšŒÊ³áµáµ‡â‹…ğšŒáµƒ + cÊ³áµáµ‡â‹…(1-ğšŒáµƒ)â‹…cáµƒ, ğšŒáµƒ+(1-ğšŒáµƒ)â‹…cáµƒ);
                Â¿(ğšŒáµƒ â‰¥ 0.99) â‡¥;
        Â¿(dâ‰¥1000.0) â‡¥;
        p += dâ‹…dir;
    Â¿(d>Î´ && close) â†ª ğŸœ(1,0,0,1);
    â†ª ğšŒÃ·ó·¹„((ê¬·(p-C_s)-1)â‹…â…•, 1, 1.1);

ğŸ™ a(ğŸš v) â‡’â†ª â¤ˆ(length(v-ğŸš(0,1))-1,max2(â«°(v-ğŸš(ó·°¾,1)))-1)â‹…(length(v-ğŸš(0,1))-.3);

á—œ main() â‡’
    ğŸŸ‘ğŸœ ğšŒ = render((gl_FragCoordË£Ê¸ - Â½â‹…res) Ã· min2(res));
    FragColor = ğŸœ(ğšŒÊ³áµáµ‡â‹…ğšŒáµƒ, 1);ğŸŸ‘
    
    ğŸš p = gl_FragCoord.xy Ã· min2(res) - ğŸš(Â½);
    p â‹…= 5;
    ğŸ™ h = â¤‰(â¤ˆ(a(p),a(-p))â‹…pÊ¸, length(p)-2);
    FragColor = ğŸœ(ğŸ›(max2(â«°(p))>2.01â­œ0â­h<0â­œ0â­1),1.0);
    ğŸŸ‘
    ğŸš p = gl_FragCoord.xy Ã· min2(res);
    ğŸœ c = ğŸœ(0);
    p = (p-Â½)â‹…5;
    î¬¦ ğŸ™ v = â¤ˆ(box2(p,ğŸš(1)), ê¬·(p-ğŸš(Â¾,Â¾))-1);
    î¬¦ p = elong(ğŸ›(p+ğŸš(â…’,0),0.0), ğŸ›(â«°(ô‹³(t)),0,0))Ë£Ê¸;
    ğŸœ ğ’‘ = elong_(ğŸ›(p+ğŸš(â…’,0),0.0), ğŸ›(â«°(ô‹³(t)),0,0));
    ğŸ™ A = box2(ğ’‘Ë£Ê¸,ğŸš(1));
    ğŸ™ B = ê¬·(ğ’‘Ë£Ê¸ -ğŸš(Â¾,Â¾) )-1;
    ğŸ™ v = xor(A,B)+ğ’‘Ê·;
    î¬¦ ğŸ™ v = B+ğ’‘Ê·;
    î¬¦ ğŸ™ v = xor(B,B+Â½)+ğ’‘Ê·;
    ğŸ™ H = â…’;
    ğŸ™ j = â¸“(v,H);
    cáµ‡=.8â‹…(jâ‰¤Â½â‹…H â­œsmoo(â«°(2â‹…(2â‹…j/H-Â½)),8)â­ 1);
    cÊ³=vâ‰¤0 â­œcáµ‡â­ 0;
    Â¿(â«°(v)â‰¤Â¾â‹…â…’â‹…H) cáµ=1;
    cÊ·=1;
    FragColor = ğŸœ(cË£Ê¸á¶»â‹…cÊ·, 1);